
# إعداد ميزة التحقق والتسجيل عبر Telegram

هذا الدليل يشرح كيفية إعداد وتشغيل ميزتي التحقق والتسجيل عبر Telegram لمشروع My account VIP.

## المتطلبات

- Node.js (الإصدار 14 أو أحدث)
- حساب على Telegram
- وصول إلى واجهة Firebase Console

## خطوات الإعداد

### 1. إنشاء بوت Telegram

1. ابحث عن "@BotFather" في Telegram
2. استخدم الأمر `/newbot` لإنشاء بوت جديد
3. اتبع التعليمات لإعطاء البوت اسم واسم مستخدم (username)
4. ستحصل على **Token API**، احفظه للخطوات التالية

### 2. تحديث ملفات المشروع

1. استبدل `YOUR_TELEGRAM_BOT_TOKEN` في ملف `telegram-server.js` بالتوكن الذي حصلت عليه من BotFather
2. استبدل `YOUR_BOT_USERNAME` في ملف `register.html` باسم مستخدم البوت الذي أنشأته

### 3. تثبيت الحزم المطلوبة

```bash
npm install
```

### 4. تشغيل الخادم

```bash
npm start
```

أو للتشغيل في وضع التطوير (مع إعادة التشغيل التلقائي عند تغيير الملفات):

```bash
npm run dev
```

### 5. إعداد Webhook

بعد تشغيل الخادم، قم بإعداد webhook لاستقبال الرسائل من Telegram:

```
https://YOUR_SERVER_URL/setup-webhook?url=https://YOUR_SERVER_URL/telegram-webhook
```

استبدل `YOUR_SERVER_URL` بعنوان الخادم الخاص بك.

## كيفية استخدام الميزات

### ميزة التحقق عبر Telegram:

#### للمستخدمين:

1. في صفحة التسجيل، أدخل رقم الهاتف ومعرف Telegram (بدون @)
2. انقر على زر "إرسال كود التحقق"
3. اذهب إلى Telegram وابحث عن البوت الذي أنشأته
4. أرسل `/start` متبوعًا برقم هاتفك (مثال: `/start 1234567890`)
5. ستتلقى رسالة تحتوي على كود التحقق
6. أدخل هذا الكود في حقل "كود التحقق من Telegram" في صفحة التسجيل
7. أكمل عملية التسجيل كالمعتاد

### ميزة التسجيل بحساب Telegram:

#### للمستخدمين:

1. في صفحة التسجيل، انقر على زر "التسجيل بحساب Telegram"
2. ستفتح نافذة منبثقة تطلب منك تسجيل الدخول إلى حسابك على Telegram
3. قم بتسجيل الدخول والموافقة على مشاركة بياناتك مع الموقع
4. سيتم إغلاق النافذة المنبثقة تلقائيًا وسيتم تعبئة بعض حقول التسجيل تلقائيًا
5. أكمل البيانات المتبقية في نموذج التسجيل
6. انقر على زر "إنشاء حساب" لإكمال عملية التسجيل

### للمسؤولين:

1. تأكد من أن الخادم يعمل بشكل مستمر
2. تحقق من سجلات الخادم بانتظام لمراقبة أي أخطاء
3. تأكد من أن webhook معاد إعداده بشكل صحيح إذا قمت بتغيير عنوان الخادم

## استكشاف الأخطاء وإصلاحها

### مشكلة: لم يتم استلام كود التحقق على Telegram

**الحلول المحتملة:**
- تأكد من أن المستخدم أرسل `/start` متبوعًا برقم هاتفه إلى البوت
- تحقق من أن الخادم يعمل وأن webhook معاد إعداده بشكل صحيح
- تأكد من أن التوكن API صحيح في ملف `telegram-server.js`

### مشكلة: كود التحقق غير صحيح

**الحلول المحتملة:**
- تأكد من أن المستخدم أدخل الكود الذي تلقاه على Telegram بشكل صحيح
- تحقق من أن localStorage في المتصفح لا يزال يحتوي على الكود الصحيح

### مشكلة: خطأ في الاتصال بالخادم

**الحلول المحتملة:**
- تأكد من أن الخادم يعمل على المنفذ الصحيح
- تحقق من إعدادات الشبكة وجدار الحماية
- تأكد من أن عنوان الخادم في طلب fetch صحيح

## ملاحظات أمنية

- تأكد من تأمين الخادم الخاص بك ضد الوصول غير المصرح به
- لا تشارك توكن API الخاص بالبوت مع أي شخص
- تأكد من أن جميع البيانات الحساسة يتم تشفيرها عند نقلها
